**유연하고 재사용 가능한 퍼블릭 인터페이스를 만드는 데 도움이 되는 설계 원칙과 기법을 익히고 적용해야 한다.**

## 01. 협력과 메시지

### 클라이언트-서버 모델

- 협력 안에서 메시지를 전송하는 객체를 클라이언트, 메시지를 수신하는 객체를 서버라고 부른다.
- 두 객체 사이의 협력 관계를 설명하기 위해 사용하는 전통적인 메타포이다.
- 협력은 클라이언트가 서버의 서비스를 요청하는 단방향 상호작용이다.

### 메시지와 메시지 전송

한 객체가 다른 객체에게 도움을 요청하는 것을 `메시지 전송` 또는 `메시지 패싱`이라고 부른다.  
메시지를 전송하는 객체를 `메시지 전송자` 그리고 그 메시지를 수신하는 객체를 `메시지 수신자`라고 부른다.

메시지는 `오퍼레이션명`과 `인자`로 구성되며, 메시지 전송은 여기에 메시지 수신자를 추가한 것이다.

> condition.isSatisfiedBy(screening)  
> 수신자.오퍼레이션명(인자)

### 메시지와 메서드

메시지를 수신했을 때 실제로 실행되는 함수 또는 프로시저를 `메서드`라고 부른다.
동일한 메시지를 전송하더라도 객체의 타입에 따라 실행되는 메서드가 달라질 수 있다.
죽, 컴파일 시점과 실행 시점의 의미가 달라질 수 있다. 이러한 구분이 수신자와 송신자의
결합을 느슨하게 만들 수 있게 한다.

### 퍼블릭 인터페이스와 오퍼레이션

- 퍼블릭 인터페이스 : 객체가 의사소통을 위해 외부에 공개하는 메시지의 집합
- 오퍼레이션 : 퍼블릭 인터페이스에 포함된 메시지

오퍼레이션은 내부 구현 코드는 제외하고 단순히 메시지와 관련된 시그니처를 가리키는 경우가
대부분이다. 예로 DiscountCondition 인터페이스에 정의된 isSatisfiedBy가 오퍼레이션에 해당한다.

### 시그니처

오퍼레이션 또는 메서드의 이름과 파라미터 목록을 합쳐 `시그니처`라고 부른다.  
\+ 하나의 클래스 안에서 2개 이상 같은 시그니처를 선언할 경우 컴파일 에러가 발생합니다.

## 02. 인터페이스와 설계 품질

> 좋은 인터페이스는 `최소한의 인터페이스`와 `추상적인 인터페이스`라는 조건을 만족해야 한다.
> - 최소한의 인터페이스 : 꼭 필요한 오퍼레이션만을 인터페이스에 포함한다.
> - 추상적인 인터페이스 : 어떻게 수행하는지가 아니라 무엇을 하는지를 표현한다.

### 퍼블릭 인터페이스의 품질에 영향을 미치는 원칙

1. 디미터 법칙
2. 묻지말고 시켜라
3. 의도를 드러내는 인터페이스
4. 명령-쿼리 분리

### 디미터의 법칙

디미터 법칙을 따르기 위해서는 클래스가 특정한 조건을 만족하는 대상에게만 메시지를 전송하도록 프로그래밍해야 한다.
그리고 디미터 법칙을 따르면 `부끄럼타는 코드`를 작성할 수 있다.

객체의 내부 구조에 강하게 결합되지 않도록 협력 경로를 제한하라.  
`낯선 자에게 말하지 말라` 또는 `오직 인접한 이웃하고만 말하라`

자바에서는 `도트(.)`를 이용하는데 `오직 하나의 도트만 사용하라`는 말로 요약되기도 한다.

#### 아래 조건을 만족하는 인스턴스에만 메시지를 전송하도록 프로그래밍해야 한다.

1. this 객체
2. 메서드의 매개변수
3. this의 속성
4. this의 속성인 컬렉션의 요소
5. 메서드 내에서 생성된 지역 객체

> 부끄럼타는 코드(shy code) : 불필요한 어떤 것도 다른 객체에게 보여주지 않으며, 다른 객체의 구현에 의존하지 않는 코드  
> 기차 충돌(train wreck) : 메시지 전송자가 수신자의 내부 구조에 대해 물어보고 반환받은 요소에 대해
> 연쇄적으로 메시지를 전송하는 것

### 묻지 말고 시켜라

디미터 법칙은 `훌륭한 메시지는 객체의 상태에 관해 묻지 말고 원하는 것을 시켜야 한다는 사실`과 같은 스타일의
메시지 작성을 장려하는 원칙을 가리키는 용어이다.

밀접하게 연관된 정보와 행동을 함께 가지는 객체를 만들 수 있다.

묻지 말고 시켜라 원칙에 따르도록 메시지를 결정하다 보면 자연스럽게 정보 전문가에게 책임을 할당하게 되고
높은 응집도를 가진 클래스를 얻을 확률이 높아진다.

### 의도를 드러내는 인터페이스

**구현과 관련된 모든 정보를 캡슐화하고 객체의 퍼블릭 인터페이스에는 협력과 관련된 의도만을 표현해야 한다.**

- 메서드가 작업을 어떻게 수행하는지를 나타내도록 이름 짓는다.
    - 메서드 수준에서 캡슐화를 위반한다. isSatisfiedByPeriod와 isSatisfiedBySequence로
      메서드를 명명했을 경우 할인 여부를 판단하는 방법이 변경되었을 때 메서드의 이름 역시 변경해야할 것이다.
      메서드 이름을 변경한다는 것은 메시지를 전송하는 클라이언트의 코드도 함께 변경해야 한다는 것을 의미한다.
- `어떻게`가 아니라 `무엇`을 하는지 드러내는 것이다.(`의도를 드러내는 선택자`)
    - 외부의 객체가 메시지를 전송하는 목적을 먼저 생각하도록 만들며, 결과적으로 협력하는 클라이언트의
      의도에 부합하도록 메서드의 이름을 짓게 된다.
- 주의점은 내부 구현 방법을 이름에 드러내면 안된다.

> 하나의 구현을 가진 메시지의 이름을 일반화하도록 도와주는 간단한 훈련 방법.  
> 매우 다른 두 번째 구현을 상상하라. 그러고는 해당 메서드에 동일한 이름을 붙인다고 상상해보라.

### 인터페이스에 의도를 드러내자

- 메서드가 어떤 작업을 수행하는 지 이름 짓는다.
- `어떻게`가 아니라 `무엇`을 하는지 드러내는 것이다.(`의도를 드러내는 선택자`)

## 03. 원칙의 함정

설계는 트레이드오프의 산물이다. 설계를 적절하게 트레이드오프 할 수 있는 능력이 숙련자와
초보자를 구분하는 가장 중요한 기준이라고 할 수 있다.  
원칙이 현재 상황에 부적합하다고 판단된다면 과감하게 원칙을 무시하라.

### 디미터 법칙은 하나의 도트(.)를 강제하는 규칙이 아니다.

디미터 법칙은 결합도와 관련된 것이며, 이 결합도가 문제가 되는 것은 객체의 `내부 구조가 외부로 노출되는 경우`로 한정된다.  
IntStream을 예로 들면 IntStream은 동일한 클래스의 인스턴스를 반환한다.
단지 IntStream을 다른 IntStream으로 변환할 뿐 객체를 둘러싸고 있는 캡슐은 그대로 유지된다.

### 결합도와 응집도의 충동

안타깝게도 문지 말고 시켜라와 디미터 법칙을 준수하는 것이 항상 긍정적인 결과로만 귀결되는 것은 아니다.
모든 상황에서 맹목적으로 위임 메서드를 추가하면 같은 퍼블릭 인터페이스 안에 어울리지 않는 오퍼레이션들이 공존하게 된다.
이는 낮은 응집도로 이어질 수 있다.

> Screening이게 PeriodCondition의 isDiscountable의 메서드를 위임 했을 경우 Screening이 기간에 따른
> 할인 조건을 판단하는 책임을 떠안게 된다. 이 경우 Screening이 담당해야 하는 본질적인 책임인지 생각해봐라.

### 04. 명령-쿼리 분리 원칙

명령-쿼리 분리 원칙은 퍼블릭 인터페이스에 오퍼레이션을 정의할 때 참고할 수 있는 지침을 제공한다.  
`질문이 답변을 수정해서는 안된다.`라는 원칙으로 요약할 수 있다.

> - 루틴 : 어떤 절차를 묶어 호출 가능하도록 이름을 부여한 기능 모듈
> - 프로시저 : 정해진 절차에 따라 내부의 상태를 변경하는 루틴의 한 종류
>   - 부수효과를 발생시킬 수 있지만 값을 반환할 수 없다.
> - 함수 : 어떤 절차에 따라 필요한 값을 계산해서 반환하는 루틴의 한 종류
>   - 값을 반환할 수 있지만 부수효과를 발생시킬 수 없다.
> - 명령 : 객체의 상태를 수정하는 오퍼레이션
> - 쿼리 : 객체와 관련된 정보를 반환하는 오퍼레이션

> 객체는 블랙박스이며 객체의 인터페이스는 객체의 관찰 가능한 상태를 보기 위한 일련의 디스플레이와 
> 객체의 상태를 변경하기 위해 누를 수 있는 버튼의 집합이다.



